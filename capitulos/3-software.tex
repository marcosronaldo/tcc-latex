\chapter{ESW e Android}
\label{cap:eswandroid}

Engenharia de software é definida pela \citeonline{swebok} como aplicação de uma abordagem sistemática, disciplinada e mensurável ao desenvolvimento, operação e mautenção de software. \citeonline{swebok} é um documento bastante consolidado que reúne diversos conceitos relacionados a engenharia de software, e foi um marco para o reconhecimento da engenharia de software como engenharia de fato. Embora sem muitos detalhes, as seções seguintes citam alguns dos processos da engenharia de software que são importantíssimos em todo o ciclo de vida do produto de software, que inclui desde a concepção do produto até a manutenção do mesmo em ambiente de produção.

Segundo \citeonline{eswissues} alguns aspectos devem ser pensados quando desenvolvendo software para dispositivos móveis:

\begin{enumerate}
\item Requisitos de interação com outras aplicações
\item Manipulação de sensores
\item Requisitos web que resultam em aplicações hibridas (mobile - web)
\item Diferentes familias de hardware
\item Requisitos de segurança contra aplicações mal intencionadas que comprometem o uso do sistema
\item Interface de Usuário projetadas para fucionar com diversas formas de interação e seguir padrões de design da plataforma
\item Teste de aplicações móveis são em geral mais desafiadores pois são realizados de maneira diferente da maneira tradicional
\item Consumo de energia
\end{enumerate}

Todos esses tópicos mencionados são muito importantes para o desenvolvimento em várias plataformas móveis, e modificam a forma com que várias atividades da engenharia de software devem ser abordadas.

\citeonline{platformchoice} propõe 3 critérios para seleção de plataformas móveis para a escolha de desenvolvedores:
\begin{enumerate}
\item Remuneração - Relacionado ao número de potenciais clientes que podem adquirir o produto. Plataforma com grande número de usuários e crescimento constante é de grande valia para desenvolvedores. Um ponto centralizado de venda de aplicativos também é um atrativo para a comercialização dos softwares desenvolvidos.
\item Carreira - As oportunidades que o desenvolvimento para a plataforma pode gerar. A possibilidade de trabalhar para grandes e renomadas empresas no mercado pode ser um fator decisivo para a escolha da plataforma. Para aumentar sua credibilidade na comunidade de desenvolvedores e ganhar visibilidade no mercado, \citeonline{platformchoice} sugere que o desenvolvedor participe de projetos de software livre, o que é facilitado quando a própria plataforma móvel é aberta.
\item Liberdade - Liberdade criativa para desenvolver. O programador deve sentir que na plataforma ele programar o que quiser. Uma plataforma consolidada com excelentes kits de desenvolvimento e dispositivos atrativos do ponto de vista de hardware e sistema operacional atraem muitos desenvolvedores. Plataformas fechadas e com muitas restrições tendem a afastar desenvolvedores que querem essa liberdade, enquanto plataformas abertas apresentam maior liberdade para desenvolvimento.
\end{enumerate}

Com seu grande crescimento e consequente tomada da maior fatia do mercado de dispositivos móveis, a plataforma Android consegue ser bastante atrativa no ponto de vista primeiro tópico, em contraste com as demais plataformas do mercado, como WindowsPhone~\footnote{\url{http://www.windowsphone.com/}} e iOS~\footnote{\url{https://www.apple.com/br/ios/}}. Mais e mais empresas aparecem no contexto do Android tanto em desenvolvimento de hardware quanto software, e as oportunidades de trabalho crescem juntamente com o crescimento da própria plataforma, como sugerido no segundo tópico. Por ser aberto, a plataforma Android também permite que desenvolvedores enviem suas contribuições e correções de bugs ao próprio sistema operacional, aumentando sua visibilidade. Da mesma forma, o Android também apresenta um sistema totalmente aberto e com kits de desenvolvimento consolidados e extensiva documentação disponível online~\footnote{\url{http://developer.android.com/}}, no mínimo se equiparando ao seu principal concorrente iOS em liberdade de desenvolvimento na data de escrita desse documento.

Tomando os critérios apresentados como base, a escolha da plataforma Android para desenvolvimento neste trabalho se apresenta clara.

\section{Requisitos}

Área de conhecimento em requisitos de software é responsável pela elicitação, análise, especificação e validação de requisitos de software, bem como a manutenção gerenciamento desses requisitos durante todo o ciclo de vida do produto \cite{swebok}.

Requisitos de software representam as necessidades de um produto, condições que ele deve cumprir para resolver um problema do mundo real que o software pretende atacar. Essas necessidades podem ser funcionalidades que o software deve apresentar para o usuário, chamados requisitos funcionais, ou outras condições que restringem as funcionalidades de alguma forma, seja por exemplo sobre tempo de execução, requisitos de segurança ou outras restrições, conhecidas como requisitos não funcionais.

Requisitos não funcionais são críticos para aplicações móveis, e estas podem precisar se adaptar dinamicamente para prover funcionalidade reduzida \cite{eswmobile}. Embora o hardware de dispositivos móveis tenha avançado bastante nos ultimos anos, dispostivos móveis ainda apresentam capacidade reduzida de processamento devido a limitações como o tamanho reduzido e capacidade limitada de refrigeração. Devido a essas e outras limitações e a grande variedade de dispositivos android no mercado, com poder computacional bem variado, aplicativos devem ser projetados para funcionar em hardware limitado. Em suma, deve-se pensar sempre em requisitos de performance e baixo consumo de recursos: uso de rede (3g/4g/wifi/bluetooth...), energia, ciclos de processamento, memória, entre outros. \citeonline{eswissues} afirma que o sucesso de qualquer aplicação, mobile ou não, depende de uma grande lista de requisitos não funcionais.  

Segundo \citeonline{eswmobile}, deve-se analisar bem requisitos de contexto de execução de aplicativos dispositivos móveis. Aplicações móveis apresentam contextos de execução que não eram obtidos em tecnologias anteriores, com dados adicionais como localização, proximidade a outros dispositivos, entre outros, que podem alterar a forma com que os aplicativos são utilizados. Aplicativos móveis tem que ser pensados para se adaptar com essas mudanças de contexto.

O sistema android permite checar a disponibilidade de recursos de hardware em tempo de execução para que o desenvolvedor possa ajustar as funcionalidades apresentadas ao usuário e prevenir que o usuário encontre problemas na utilização de determinadas funcionalidades. Por exemplo, um jogo simples como tic tac toe que utilize bluetooth para multiplayer pode desativar essa funcionalidade para dispositivos antigos que o não tenham disponível e trabalhar apenas com jogo single player contra algum tipo de jogador virtual. Dessa forma é possível prevenir a apresentação para o usuário de funcionalidades que ele na verdade não pode executar.

Requisitos de software podem ser representados de diversas formas, sendo possível a utilização de vários modelos distintos. Na metodologia ágil scrum, por exemplo, os requistos normalmente são registrados na forma de User Stories, onde são geralmente descritos na visão do usuário do sistema. Em outros contextos, podem ser descritos em casos de uso, com descrições e diagramas, ou mesmo outras formas de representação.

Requisitos de software geralmente tem como fonte o próprio cliente que contrata o serviço do desenvolvimento de sofwate, e são estraídos da descrição de como esse cliente vê o uso do sistema. Todo esse processo é muitas vezes chamado de "engenharia de requisitos".

\section{Design de software}

Desenho de software é o processo de definição da arquitetura, componentes, interfaces, e outras características de um sistema ou um componente \cite{swebok}. É durante o desenho de software que os requisitos são traduzidos na estrutura que dará base ao software sendo desenvolvido. As necessidades então são traduzidas em modelos, que descrevem os componentes e as interfaces entre os componentes. A partir desses modelos é possível avaliar a validade da solução desenhada e as restrições associadas a mesma, sendo possível avaliar diferentes soluções antes da implementação do software. A partir do design da arquitetura, é possível prever se alguns requisitos elicitados podem ou não ser atingidos com determinada solução, e mudá-la conforme necessário com pouco ou mesmo nenhum custo adicional.

A área de desenho de software pode variar conforme a tecnologia sendo utilizada. A arquitetura do sistema pode variar conforme o sistema operacional alvo, ou mesmo conforme a linguagem de programação que se está utilizando no desenvolvimento. Existem vários princípios de design de software amplamente conhecidos que se aplicam a uma imensidade de situações, sempre com o intuito de encontrar a melhor solução para cada situação e deixar o software modularizado e manutenível.

Aplicativos para o sistema Android são construídos em módulos, utilizando os componentes da API, embora possam ser criadas classes em java puro sem a utilização de nenhum recurso da API do sistema, e utilizá-las nos componentes assim como em uma aplicação java padrão desenvolvida para desktop. Várias classes de modelo em uma arquitetura MVC (Model-View-Controller), por exemplo, possivelmente serão criadas em java puro.

O Android não impõe nenhuma arquitetura específica no desenvolvimento de aplicações, deixando livre para o desenvolvedor fazer suas escolhas.

\citeonline{androidmvc} apresenta alguns tipos de arquitetura derivados do bem difundido MVC, e demonstra uma possibilidade de adaptação do MVC ao Android. Embora a arquitetura MVC possa ser utilizada no Android, ela não é fácilmente identificada, e não é intuitiva de ser implementada. Activities são os componentes mais difíceis de serem encaixados na arquitetura MVC padrão, embora sejam bem adaptadas às necessidades do desenvolvedor. Por padrão elas tem responsabilidades correspondentes ao Controller e ao View, são interpretadas de forma diferente por vários desenvolvedores.

Neste trabalho será utilizada uma arquitetura semelhante a arquitetura "Android Passive MVC" apresentada em \citeonline{androidmvc}, com o intuito básico de separar a lógica de negócio da apresentação de dados, objetivo principal da arquitetura MVC. Mais detalhes serão apresentados nos capítulos seguintes.

\cite{androidmvc}

\subsection{Componentes Android}

Android provê um framework para desenvolver aplicativos baseado nos componentes descritos no capítulo~\ref{cap:android-os}. Os aplicativos são construídos com qualquer combinação desses componentes, que podem ser utilizados individualmente, sem a presença dos demais. Cada um dos componentes pode ser uma entrada para o aplicativo sendo desenvolvido.

A comunicação entre os componentes de cada aplicativo é feita por meio do Binder\footnote{\url{http://developer.android.com/guide/components/bound-services.html}}, mecanismo de comunicação entre processos. O Binder comunica processos através da troca de mensagens (chamadas parcels), que podem referenciar dados primitivos e objetos da API assim como referencias para outros objetos binder. De forma geral, um service no android pode ter sua interface definida em AIDL (Android interface definition language), e uma aplicação que tiver referencia para o binder desse service pode executar chamadas de procedimento remoto (RPC - remote procedure calls) para qualquer método definido nessa interface AIDL. Embora essa forma de comunicação entre processoes seja recomendada, o sistema android também suporta mecanismos de comunicação padrões do linux como sockets e pipes \cite{heuser2014}. Embora o binder apresente acesso direto para alguns componentes, essa comunicação pode ser feita de forma indireta utilizando Intents. Como descrito no capítulo~\ref{cap:android-os}, Intents são geralmente recebidos por receivers que estão registrados para recebê-los. Esse registro é feito por meio de Intent Filters. Entretanto, activities e services também podem utilizar desse mecanismo para ser iniciados e finalizados. Quando um Intent é enviado ao sistema via broadcast, ele é recebido pelo sistema e resolvidos pelo Activity Manager Service (AMS), que seleciona o melhor componente para tratá-lo, e então inicia o componente que o recebeu independente da aplicação a que ele pertença. Assim como já descrito, permissões podem ser criadas para restringir essa comunicação global, mas a principio qualquer componente pode receber um intent de qualquer outra. 

Embora os componentes sejam geralmente registrados no sistema, através do AndroidManifest.xml, BroadcastReceivers podem ser registrados dinamicamente dentro do ciclo de vida da aplicação. Isso quer dizer que é possível criar um receiver projetado para funcionar apenas enquanto a aplicação estiver em execução. Esse BroadcastReceiver então é registrado por linha de comando da API e desativado quando requisitado, criando uma janela onde se deseja que esse componente funcione.

De forma geral, para desenhar uma arquitetura para sistema android deve-se levar em conta todos esses componentes e conhecer bem sua aplicabilidade e a comunicação entre os mesmos. Se for necessário ter algum processo em background independente de feedback do usuário, por exemplo, deve-se utilizar do componente service. Caso contrário, quando o usuário fechar a interface gráfica do aplicativo, o aplicativo terá sua execução pausada e seu estado salvo para retorno posterior, deixando de executar alguma tarefa que não deveria ter sido interrompida. Como um exemplo mais paupável, o aplicativo do facebook precisa necessariamente utilizar de um serviço para que, mesmo quando não estiver em execução, notificações de mensagens e atualizações de status cheguem na tela do usuário.

Embora pareça restringir o design de aplicativos, o uso desses componentes unifica a forma com que os aplicativos são desenvolvidos. A API do android já disponibiliza acesso a vários recursos de hardware do sistema na forma de componentes, e assim como é possível utilizar os componentes do sistema, é possível utilizar componentes de qualquer outra aplicação da mesma maneira - se a permissão for concedida- , e criar os seus próprios componentes para uso de terceiros de forma padronizada. Em suma, é tão fácil usar componentes criados por alguma aplicação qualquer quanto componentes internos do sistema graças ao framework de desenvolvimento android.

\subsection{Interface de usuário}

O design de interface deve ser realizado com o intuito de alcançar usuários com capacidades motoras restritas, e outras limitações como problemas de visão ou audição. Dependendo do público alvo do aplicativo, esses aspectos devem ser considerados.

Com o desafio de fazer uso do pequeno espaço de tela, o design da interface gráfica apresenta mais importancia do que jamais teve no desenvolvimento de aplicativos móveis \cite{eswissues}. Usuários estão sempre tentando acessar várias tarefas diferentes, e geralmente tem baixa tolerância a aplicativos instáveis ou não responsivos, mesmo que gratuitos \cite{eswmobile}. 

A base da interface gráfica de usuário no Android é construída em cima da classe View, sendo que todos os elementos visíveis na tela, e alguns não visíveis, são derivados dessa classe \cite{androidarch2010}. O sistema android disponibiliza vários componentes gráficos como botões, caixas de texto, imagens, caixas de seleção de dados, calendário, componentes de mídia (audio e video), entre outros, e a interface gráfica é construída em cima desses componentes gráficos, que podem ser customizados para um comportamento ou aparência um pouco diferente se assim for desejado, extendendo e customizando suas respectivas classes em java. Existe um padrão de design\footnote{\url{https://developer.android.com/design/get-started/principles.html}} que é recomndado que seja seguido.

A interface gráfica do usuário é construída geralmente em formato xml utilizando esses componentes gráficos já disponibilizados na API. Esses arquivos xml são então carregados pela API em java quando necessário, e podem ser editados dinamicamente através da API, em linguagem java.

Todo projeto de aplicativo android possui um arquivo em java R auto-gerado que contém identificação os recursos do aplicativo. Cada componente gráfico disponibilizado na API e utilizado nos arquivos xml pode ser identificado de qualquer local do aplicativo pelo seu ID atribuído no arquivo xml. Dessa forma, é possível localizar facilmente dentro de sua Activity (componente para interface gráfica) cada componente para ser carregado, modificado e utilizado.

\section{Construção de software}

Essa área de conhecimento é responsável pela codificação do software, por transformar a arquitetura desenhada e seus modelos em código fonte. A construção de software está extremamente ligada ao desenho e às atividades de teste, partindo do primeiro e gerando insumo para o segundo \cite{swebok}.

Várias medidas podem ser coletadas do próprio código pra auxiliar a avaliação da qualidade do produto sendo construído e gerar insumo para o próprio desenvolvedor reavaliar sua implementação antes da fase de testes.

Para construção de aplicativos para a plataforma Android, o Google disponibiliza um kit de desenvolvimento de aplicativos chamado Android SDK~\footnote{url{https://developer.android.com/sdk}} (Software Development Kit). Ele provê as bibliotecas da API e as ferramentas necessárias para cronstuir, testar e debugar aplicativos. Android SDK está disponível para os sistemas operacionais Linux, MAC e Windows.

Embora exista uma ferramenta em desenvolvimento (em fase Beta na data de escrita deste documento) para a construção de aplicativos chamada Android Studio~\footnote{url{https://developer.android.com/sdk/installing/studio.html}}, o android SDK é distribuido por padrão com a IDE Eclipse, juntamente com plugin ADT (Android Development Tools), incluindo as ferramentas de visualização de interface em xml, ferramentas de debug de código, análise de arquitetura, níveis de hierarquia de componentes gráficos, testes de desempenho, acesso a memória flash e outros recursos do dispositivo via IDE, entre outras funcionalidades.

Após fazer o download do Eclipse ADT Bundle, que contém todas as ferramentas mencionadas, basta fazer o download das API's desejadas e utilizar do recurso da própria IDE para criar um projeto Android~\footnote{url{https://developer.android.com/tools/projects/index.html}}, que já vem com uma estrutura pronta para ser trabalhada, separando e categorizando código fonte e outros recursos utilizados no desenvolvimento.

É necessário especificar a versão alvo do sistema para o qual se está desenvolvendo. Para manter a compatibilidade, geralmente desenvolvedores utilizam como versão mínima a 2.3 ou anterior, embora para utilizar alguns recursos seja necessário utilizar uma API mínima mais recente. Todas as API's utilizadas precisam ser baixadas pela própria ferramenta de download do SDK. Para desenvolver para android kitkat 4.4.2 com compatibilidade com android 2.3 por exemplo, deve-se obter ambas API's.

Juntamente com o SDK, o desenvolvedor tém acesso a uma ferramenta de criação de dispositivos virtuais AVD (Android Virtual Devices) para poder executar as aplicações sendo desenvolvidoas sem a necessidade de um dispositivo físico disponível para esse fim.

\section{Testes}

Testes de software consistem em verificar se o produto de software se comporta da forma esperada em um determinado conjunto de casos específicos, selecionados com o intuito de representar o maior número de situações diferentes que podem ocorrer durante o uso do sistema, com o software em execução. Os testes têm que ser projetados para checar se o software está de acordo com as necessidades do usuário, procedimento conhecido como validação, e para verificar se as funcionalidades estão de acordo com a especificação, procedimento conhecido como verificação \cite{swebok}. Testes podem ser realzados em vários níveis, desde o teste de pequenos trechos de código até a interação entre componentes e o teste da interface gráfica do usuário.

Existem vários tipos de testes aplicáveis a determinados tipos de sistema. De acordo com as necessidades e o ambiente onde o sistema irá funcionar, vários testes podem ser ou não necessários para garantir o funcionamento do sistema sob diversas condições. Sistemas web podem exigir testes de carga e stress para avaliar a quantidade de usuários simultaneos suportados, por exemplo. Sistemas críticos já também necessitam de testes de recuperação, para avaliar a capacidade do sistema de restaurar seu funcionamento após algum tipo de falta.

Ter uma boa suite de testes é de grande valia para a manutenção de um produto de software, uma vez que sempre que uma modificação precisar ser feita no sistema, é possível verificar de forma automatizada se algum comportamento foi indevidamente alterado pela modificação realizada.

O sistema Android provê um framework para testes\footnote{\url{http://developer.android.com/tools/testing/testing\_android.html}} , com várias ferramentas que ajudam a testar o aplicativo sendo desenvolvido em vários níveis, de testes unitários a testes realacionados ao framework de desenvolvimento de aplicativos. Todas as ferramentas necessárias para utilizar a API de testes disponível no framework de desenvolvimento android são disponibiizadas juntamente com o android SDK.

Podem existir classes em java puro que não utilizam a API de desenvolvimento do Android. Conseguir fazer essa separação de classes que utilizam o framework e classes em java puro pode significar uma maior facilidade em testar determinadas partes da aplicação, uma vez que podem ser diretamente utilizados os já bem difundidos JUnit tests para essas classes. Entretanto, muitas classes são construídas através dos componentes, e o funcionamento das mesmas também precisa ser testado.

As suites de teste são baseadas em JUnit, e então da mesma forma que é possível utilizar JUnit para desenvolver testes para classes que não utilizam a API android, é possível utilizar as extensões do JUnit criadas especificamente para testar cada componente do aplicativo sendo desenvolvido. Existem extensões JUnit específicas para cada componente do android, e essas classes contém métodos auxiliares para criar "Mock Objects". Estes são criados para simular outros objetos do contexto de execução real do aplicativo.

O kit de desenvolvimento para a plataforma Android inclui ferramentas automatizadas de teste de interface gráfica. O robotium, por exemplo, realiza testes de caixa preta em cima da interface gráfica do aplicativo. São criadas rotinas de teste em java semelhantes ao JUnit, com asserts para validar os resultados. Com ele é possível criar rotinas robustas de testes para validar critérios de aceitação pré definidos, simulando interações do usuário com uma ou várias activities. Existe a ferramenta monkeyrunner, onde se cria scripts em python para instalar e executar algum aplicativo, enviando comandos e cliques para o mesmo, e salvando screenshots do dispositivo no computador com resultados. Há também a ferramenta Monkey, que é utilizada para fazer testes de stress no aplicativo gerando inputs pseudo-aleatórios.

\section{Manutenção}

A manutenção de software trata dos esforços de desenvolvimento com o software já em produção, isto é, em funcionamento no seu devdo ambiente. Problemas que passaram despercebidos durante as fases de construção e testes são encontrados e corrigidos durante a manutenção do sistema. Da mesma forma, o usuário pode requisitar novas funcionalidades que ele não havia pensado antes do uso do sistema, e o desenvolvimento dessas novas funcionalidades é também tratado como manutenção uma vez que o software já se encontra em produção, num processo conhecido como evolução de software. Revisões de código e esforços com manutenibilidade também podem ser consideradas atividades de manutenção, embora possam acontecer antes do sistema entrar em produção.

A manutenção de software acontece por período mais longo que as demais fases do desenvolvimento do software citadas nos tópicos anteriores, ocupando a maior parte do ciclo de vida do produto.

A separação de componentes independentes apresentados neste capítulo é de grande valia para a manutenibilidade do sistema. Essa separação permite que componentes tenham sua funcionalidade específica melhor compreendida e possam ser substituídos sem grandes impactos nos demais. 

Atividades de design de software devem ser reforçadas para garantir uma fase de manutenção com a menor quantidade de problemas possível. Uma arquitetura modularizada é mais fácil de ser entendida e modificada e consequentemente mantida. Também é importante que se utilize de padrões de codificação, identação e documentação para que a manutenção seja facilitada inclusive para desenvolvedores que não tem familiaridade com o código desenvolvido. Empresas tendem a colocar equivocadamente engenheiros junior para dar manutenção a sistemas e engenheiros mais experientes para desenvolver novos projetos, e adotar práticas de desenvolvimento que agem em favor à manutenibilidade ajudam a amenizar os problemas causados por esse tipo de alocação de recursos humanos.

Sendo um sistema de código aberto, o Android permite que o desenvolvedor possa o analisar e consequentemente o entender a ponto de corrigir bugs do sistema, criar funcionalidades novas, e também portá-lo para novos harwares \cite{googleandroid}. Isso é um ponto importante para atividades de manutenção do sistema android como um todo, e permitiu que a plataforma crescesse de forma extremamente acelerada em um pequeno espaço de tempo. Um dos motivos para a própria plataforma linux estar em um estado tão estável nos dias atuais foi os anos que a mesma teve de contribuição da comunidade sendo um software livre e portanto tendo seu código aberto a qualquer desenvolvedor, assim como o sistema Android. 