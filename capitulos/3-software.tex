\chapter{ESW e Android}
\label{cap:eswandroid}

Engenharia de software é definida pela \cite{swebok} como aplicação de uma abordagem sistemática, disciplinada e mensurável ao desenvolvimento, operação e manutenção de software. O SWEBoK é um documento bastante consolidado que reúne diversos conceitos relacionados a engenharia de software, e foi um marco para o reconhecimento da engenharia de software como engenharia de fato. Embora sem muitos detalhes, as seções seguintes citam alguns dos processos da engenharia de software que são importantes em todo o ciclo de vida do produto de software, que inclui desde a concepção do produto até a manutenção do mesmo em ambiente de produção.

Segundo \citeonline{eswissues} alguns aspectos devem ser pensados quando desenvolvendo software para dispositivos móveis:

\begin{enumerate}
\item Requisitos de interação com outras aplicações;
\item Manipulação de sensores;
\item Requisitos web que resultam em aplicações hibridas (\textit{mobile} - \textit{web});
\item Diferentes famílias de hardware;
\item Requisitos de segurança contra aplicações mal intencionadas que comprometem o uso do sistema;
\item Interface de Usuário projetadas para funcionar com diversas formas de interação e seguir padrões de design da plataforma;
\item Teste de aplicações móveis são em geral mais desafiadores pois são realizados de maneira diferente da maneira tradicional;
\item Consumo de energia;
\end{enumerate}

Todos esses tópicos mencionados são muito importantes para o desenvolvimento em várias plataformas móveis, e modificam a forma com que várias atividades da engenharia de software devem ser abordadas.

\citeonline{platformchoice} propõe 3 critérios para seleção de plataformas móveis:
\begin{enumerate}
\item Remuneração - Relacionado ao número de potenciais clientes que podem adquirir o produto. Plataforma com grande número de usuários e crescimento constante é de grande valia para desenvolvedores. Um ponto centralizado de venda de aplicativos também é um atrativo para a comercialização dos softwares desenvolvidos.
\item Carreira - As oportunidades que o desenvolvimento para a plataforma pode gerar. A possibilidade de trabalhar para grandes e renomadas empresas no mercado pode ser um fator decisivo para a escolha da plataforma. Para aumentar sua credibilidade na comunidade de desenvolvedores e ganhar visibilidade no mercado, \citeonline{platformchoice} sugere que o desenvolvedor participe de projetos de software livre, o que é facilitado quando a própria plataforma móvel é aberta.
\item Liberdade - Liberdade criativa para desenvolver. O programador deve sentir que na plataforma ele pode programar o que quiser. Uma plataforma consolidada com excelentes kits de desenvolvimento e dispositivos atrativos do ponto de vista de hardware e sistema operacional atraem muitos desenvolvedores. Plataformas fechadas e com muitas restrições tendem a afastar desenvolvedores que querem essa liberdade, enquanto plataformas abertas apresentam maior liberdade para desenvolvimento.
\end{enumerate}

Com seu grande crescimento e consequente tomada da maior fatia do mercado de dispositivos móveis, a plataforma Android consegue ser bastante atrativa no ponto de vista primeiro tópico, em contraste com as demais plataformas do mercado, como WindowsPhone~\footnote{\url{http://www.windowsphone.com/}} e iOS~\footnote{\url{https://www.apple.com/br/ios/}}. Mais e mais empresas aparecem no contexto do Android tanto em desenvolvimento de hardware quanto software, e as oportunidades de trabalho crescem juntamente com o crescimento da própria plataforma, como sugerido no segundo tópico. Por ser aberto, a plataforma Android também permite que desenvolvedores enviem suas contribuições e correções de bugs ao próprio sistema operacional, aumentando sua visibilidade. Da mesma forma, o Android também apresenta um sistema totalmente aberto e com kits de desenvolvimento consolidados e extensiva documentação disponível online~\footnote{\url{http://developer.android.com/}}, no mínimo se equiparando ao seu principal concorrente iOS em liberdade de desenvolvimento na data de escrita desse documento.

Tomando os critérios apresentados como base, a escolha da plataforma Android para desenvolvimento neste trabalho é feita de forma clara.

\section{Requisitos}

Área de conhecimento em requisitos de software é responsável pela elicitação, análise, especificação e validação de requisitos de software, bem como a manutenção gerenciamento desses requisitos durante todo o ciclo de vida do produto \cite{swebok}.

Requisitos de software representam as necessidades de um produto, condições que ele deve cumprir para resolver um problema do mundo real que o software pretende atacar. Essas necessidades podem ser funcionalidades que o software deve apresentar para o usuário, chamados requisitos funcionais, ou outras condições que restringem as funcionalidades de alguma forma, seja por exemplo sobre tempo de execução, requisitos de segurança ou outras restrições, conhecidas como requisitos não funcionais.

Requisitos não funcionais são críticos para aplicações móveis, e estas podem precisar se adaptar dinamicamente para prover funcionalidade reduzida \cite{eswmobile}. Embora o hardware de dispositivos móveis tenha avançado bastante nos últimos anos, dispositivos móveis ainda apresentam capacidade reduzida de processamento devido a limitações como o tamanho reduzido e capacidade limitada de refrigeração. Devido a essas e outras limitações e a grande variedade de dispositivos Android no mercado, com poder computacional bem variado, aplicativos devem ser projetados para funcionar em hardware limitado. Em suma, deve-se pensar sempre em requisitos de performance e baixo consumo de recursos: uso de rede (3g/4g/wifi/bluetooth...), energia, ciclos de processamento, memória, entre outros. \citeonline{eswissues} afirma que o sucesso de qualquer aplicação, \textit{mobile} ou não, depende de uma grande lista de requisitos não funcionais.  

Segundo \citeonline{eswmobile}, deve-se analisar bem requisitos de contexto de execução de aplicativos dispositivos móveis. Aplicações móveis apresentam contextos de execução que não eram obtidos em tecnologias anteriores, com dados adicionais como localização, proximidade a outros dispositivos, entre outros, que podem alterar a forma com que os aplicativos são utilizados. Aplicativos móveis tem que ser pensados para se adaptar com essas mudanças de contexto.

O sistema Android permite checar a disponibilidade de recursos de hardware em tempo de execução para que o desenvolvedor possa ajustar as funcionalidades apresentadas ao usuário e prevenir que o usuário encontre problemas na utilização de determinadas funcionalidades. Por exemplo, um jogo simples como \textit{tic tac toe} que utilize \textit{bluetooth} para \textit{multiplayer} pode desativar essa funcionalidade para dispositivos antigos que o não tenham disponível e trabalhar apenas com jogo \textit{single player} contra algum tipo de jogador virtual. Dessa forma é possível prevenir a apresentação para o usuário de funcionalidades que ele na verdade não pode executar.

Requisitos de software podem ser representados de diversas formas, sendo possível a utilização de vários modelos distintos. Na metodologia ágil scrum, por exemplo, os requisitos normalmente são registrados na forma de \textit{User Stories}, onde são geralmente descritos na visão do usuário do sistema. Em outros contextos, podem ser descritos em casos de uso, com descrições textuais e diagramas, ou outras várias formas de representação.

Requisitos de software geralmente tem como fonte o próprio cliente que contrata o serviço do desenvolvimento de software, e são extraídos da descrição de como esse cliente vê o uso do sistema. Todo esse processo é muitas vezes chamado de "engenharia de requisitos".

\section{Design de software}

Desenho de software é o processo de definição da arquitetura, componentes, interfaces, e outras características de um sistema ou um componente \cite{swebok}. É durante o desenho de software que os requisitos são traduzidos na estrutura que dará base ao software sendo desenvolvido. As necessidades então são traduzidas em modelos, que descrevem os componentes e as interfaces entre os componentes. A partir desses modelos é possível avaliar a validade da solução desenhada e as restrições associadas a mesma, sendo possível avaliar diferentes soluções antes da implementação do software. A partir do design da arquitetura, é possível prever se alguns requisitos elicitados podem ou não ser atingidos com determinada solução, e mudá-la conforme necessário com pouco ou mesmo nenhum custo adicional.

A área de desenho de software pode variar conforme a tecnologia sendo utilizada. A arquitetura do sistema pode variar conforme o sistema operacional alvo, ou mesmo conforme a linguagem de programação que se está utilizando no desenvolvimento. Existem vários princípios de design de software amplamente conhecidos que se aplicam a uma imensidade de situações, sempre com o intuito de encontrar a melhor solução para cada situação e deixar o software modularizado e manutenível.

Aplicativos para o sistema Android são construídos em módulos, utilizando os componentes da API, embora possam ser criadas classes em Java puro sem a utilização de nenhum recurso da API do sistema, e utilizá-las nos componentes assim como em uma aplicação Java padrão desenvolvida para \textit{desktop}. Várias classes de modelo em uma arquitetura MVC (\textit{Model-View-Controller}), por exemplo, possivelmente serão criadas em Java puro.

O Android não impõe nenhuma arquitetura específica no desenvolvimento de aplicações, deixando livre para o desenvolvedor fazer suas escolhas.

\citeonline{androidmvc} apresentam alguns tipos de arquitetura derivados do bem difundido MVC, e demonstram uma possibilidade de adaptação do MVC ao Android. Embora a arquitetura MVC possa ser utilizada no Android, ela não é facilmente identificada, e não é intuitiva de ser implementada. \textit{Activities} são os componentes mais difíceis de serem encaixados na arquitetura MVC padrão, embora sejam bem adaptadas às necessidades do desenvolvedor. Por padrão elas tem responsabilidades correspondentes ao \textit{Controller} e ao \textit{View}, e são interpretadas de forma diferente por vários desenvolvedores.

Neste trabalho será utilizada uma arquitetura diferente das derivações MVC apresentadas em \citeonline{androidmvc}, embora exista o intuito básico de separar a lógica de negócio da apresentação de dados, objetivo principal da arquitetura MVC. Mais detalhes serão apresentados no capítulo ~\ref{cap:elastic}.

\subsection{Componentes Android}

O Android provê um \textit{framework} para desenvolver aplicativos baseado nos componentes descritos no capítulo~\ref{cap:android-os}. Os aplicativos são construídos com qualquer combinação desses componentes, que podem ser utilizados individualmente, sem a presença dos demais. Cada um dos componentes pode ser uma entrada para o aplicativo sendo desenvolvido.

A comunicação direta entre os componentes de cada aplicativo é feita por meio do \textit{Binder}\footnote{\url{http://developer.android.com/guide/components/bound-services.html}}, mecanismo de comunicação entre processos. O \textit{Binder} comunica processos através da troca de mensagens (chamadas \textit{parcels}), que podem referenciar dados primitivos e objetos da API assim como referencias para outros objetos \textit{binder}. De forma geral, um \textit{service} no Android pode ter sua interface definida em AIDL (\textit{Android interface definition language}), e uma aplicação que tiver referencia para o \textit{binder} desse \textit{service} pode executar chamadas de procedimento remoto (\textit{RPC - remote procedure calls}) para qualquer método definido nessa interface AIDL. Embora essa forma de comunicação entre processos seja recomendada, o sistema Android também suporta mecanismos de comunicação padrões do Linux como \textit{sockets} e \textit{pipes} \cite{heuser2014}. Embora o \textit{binder} apresente acesso direto para alguns componentes, essa comunicação pode ser feita de forma indireta utilizando \textit{Intents}. Como descrito no capítulo~\ref{cap:android-os}, Intents são geralmente recebidos por \textit{receivers} que estão registrados para recebê-los. Esse registro é feito por meio de \textit{Intent Filters}. Entretanto, \textit{activities} e \textit{services} também podem utilizar desse mecanismo para ser iniciados e finalizados. Quando um \textit{Intent} é enviado ao sistema via \textit{broadcast}, ele é recebido pelo sistema e resolvido pelo \textit{Activity Manager Service} (AMS), que seleciona o melhor componente para tratá-lo, e então inicia o componente que o recebeu independente da aplicação a que ele pertença. Assim como já descrito, permissões podem ser criadas para restringir essa comunicação, mas a principio qualquer componente pode receber um \textit{intent} de qualquer outra. 

Embora os componentes sejam geralmente registrados no sistema, através do \textit{AndroidManifest.xml}, \textit{BroadcastReceivers} podem ser registrados dinamicamente dentro do ciclo de vida da aplicação. Isso quer dizer que é possível criar um \textit{receiver} projetado para funcionar apenas enquanto a aplicação estiver em execução. Esse \textit{BroadcastReceiver} então é registrado por linha de comando da API e desativado quando requisitado, criando uma janela de tempo onde se deseja que esse componente funcione.

De forma geral, para desenhar uma arquitetura para sistema Android deve-se levar em conta todos esses componentes e conhecer bem sua aplicabilidade e a comunicação entre os mesmos. Se for necessário ter algum processo em background independente de \textit{feedback} do usuário, por exemplo, deve-se utilizar do componente \textit{service}. Caso contrário, quando o usuário fechar a interface gráfica do aplicativo, o aplicativo terá sua execução pausada e seu estado salvo para retorno posterior, deixando de executar alguma tarefa que não deveria ter sido interrompida. Como um exemplo mais palpável, o aplicativo do facebook precisa necessariamente utilizar de um serviço para que, mesmo quando não estiver em foco no sistema, notificações de mensagens e atualizações de status cheguem na tela do usuário.

Embora pareça restringir o design de aplicativos, o uso desses componentes unifica a forma com que os aplicativos são desenvolvidos. A API do Android já disponibiliza acesso a vários recursos de hardware do sistema na forma de componentes, e assim como é possível utilizar os componentes do sistema, é possível utilizar componentes de qualquer outra aplicação da mesma maneira - se a permissão for concedida- , e criar os seus próprios componentes para uso de terceiros de forma padronizada. Em suma, é tão fácil usar componentes criados por alguma aplicação qualquer quanto componentes internos do sistema graças ao \textit{framework} de desenvolvimento Android.

\subsection{Interface de usuário}

O design de interface deve ser realizado com o intuito de alcançar usuários com capacidades motoras restritas, e outras limitações como problemas de visão ou audição. Dependendo do público alvo do aplicativo, esses aspectos devem ser considerados.

Com o desafio de fazer uso do pequeno espaço de tela, o design da interface gráfica apresenta mais importância do que jamais teve no desenvolvimento de aplicativos móveis \cite{eswissues}. Usuários estão sempre tentando acessar várias tarefas diferentes, e geralmente tem baixa tolerância a aplicativos instáveis ou não responsivos, mesmo que gratuitos \cite{eswmobile}. 

A base da interface gráfica de usuário no Android é construída em cima da classe \textit{View}, sendo que todos os elementos visíveis na tela, e alguns não visíveis, são derivados dessa classe \cite{androidarch2010}. O sistema Android disponibiliza vários componentes gráficos como botões, caixas de texto, imagens, caixas de seleção de dados, calendário, componentes de mídia (áudio e vídeo), entre outros, e a interface gráfica é construída em cima desses componentes gráficos, que podem ser customizados para um comportamento ou aparência um pouco diferente se assim for desejado, estendendo e customizando suas respectivas classes em Java. Existe um padrão de design\footnote{\url{https://developer.android.com/design/get-started/principles.html}} que é recomendado que seja seguido.

A interface gráfica do usuário é construída geralmente em formato xml utilizando esses componentes gráficos já disponibilizados na API. Esses arquivos xml são então carregados pela API em Java quando necessário, e podem ser editados dinamicamente através da API, em linguagem Java.

Todo projeto de aplicativo Android possui um arquivo em Java chamado \textit{R} (\textit{Resources}) autogerado que contém identificação dos recursos do aplicativo. Cada componente gráfico disponibilizado na API e utilizado nos arquivos xml pode ser identificado de qualquer local do aplicativo pelo seu ID atribuído no arquivo xml. Dessa forma, é possível localizar facilmente dentro de sua \textit{Activity} cada componente para ser carregado, modificado e utilizado.

\section{Construção de software}

Essa área de conhecimento é responsável pela codificação do software, por transformar a arquitetura desenhada e seus modelos em código fonte. A construção de software está extremamente ligada ao desenho e às atividades de teste, partindo do primeiro e gerando insumo para o segundo \cite{swebok}.

Várias medidas podem ser coletadas do próprio código pra auxiliar a avaliação da qualidade do produto sendo construído e gerar insumo para o próprio desenvolvedor reavaliar sua implementação antes da fase de testes.

Para construção de aplicativos para a plataforma Android, o Google disponibiliza um kit de desenvolvimento de aplicativos chamado Android SDK~\footnote{\url{https://developer.android.com/sdk}} (\textit{Software Development Kit}). Ele provê as bibliotecas da API e as ferramentas necessárias para construir, testar e debugar aplicativos. Android SDK está disponível para os sistemas operacionais Linux, MAC e Windows.

Embora exista uma ferramenta em desenvolvimento (em fase Beta na data de escrita deste documento) para a construção de aplicativos chamada \textit{Android Studio}~\footnote{\url{https://developer.android.com/sdk/installing/studio.html}}, o Android SDK é distribuído por padrão com a IDE Eclipse, juntamente com \textit{plugin} ADT (\textit{Android Development Tools}), incluindo as ferramentas de visualização de interface em xml, ferramentas de \textit{debug} de código, de análise de arquitetura, níveis de hierarquia de componentes gráficos, testes de desempenho, acesso a memória flash e outros recursos do dispositivo via IDE, entre outras funcionalidades.

Após fazer o download do \textit{Eclipse ADT Bundle}, que contém todas as ferramentas mencionadas, basta fazer o download das APIs desejadas e utilizar do recurso da própria IDE para criar um projeto Android~\footnote{\url{https://developer.android.com/tools/projects/index.html}}, que já vem com uma estrutura pronta para ser trabalhada, separando e categorizando código fonte e outros recursos utilizados no desenvolvimento.

É necessário especificar a versão alvo do sistema para o qual se está desenvolvendo. Para manter a compatibilidade, geralmente desenvolvedores utilizam como versão mínima a 2.3 ou anterior, embora para utilizar alguns recursos seja necessário utilizar uma API mínima mais recente. Todas as APIs utilizadas precisam ser baixadas pela própria ferramenta de download do SDK. Para desenvolver para Android kitkat 4.4.2 com compatibilidade com Android 2.3 por exemplo, deve-se obter ambas APIs.

Juntamente com o SDK, o desenvolvedor tem acesso a uma ferramenta de criação de dispositivos virtuais AVD (\textit{Android Virtual Devices}) para poder executar as aplicações sendo desenvolvidas sem a necessidade de um dispositivo físico disponível para esse fim.

\section{Testes}

Testes de software consistem em verificar se o produto de software se comporta da forma esperada em um determinado conjunto de casos específicos, selecionados com o intuito de representar o maior número de situações diferentes que podem ocorrer durante o uso do sistema, com o software em execução. Os testes têm que ser projetados para checar se o software está de acordo com as necessidades do usuário, procedimento conhecido como validação, e para verificar se as funcionalidades estão de acordo com a especificação, procedimento conhecido como verificação \cite{swebok}. Testes podem ser realizados em vários níveis, desde o teste de pequenos trechos de código até a interação entre componentes e o teste da interface gráfica do usuário.

Existem vários tipos de testes aplicáveis a determinados tipos de sistema. De acordo com as necessidades e o ambiente onde o sistema irá funcionar, vários testes podem ser ou não necessários para garantir o funcionamento do sistema sob diversas condições. Sistemas web podem exigir testes de carga e stress para avaliar a quantidade de usuários simultâneos suportados, por exemplo. Sistemas críticos já também necessitam de testes de recuperação, para avaliar a capacidade do sistema de manter ou restaurar seu funcionamento após algum tipo de falta.

Ter uma boa suíte de testes é de grande valia para a manutenção de um produto de software, uma vez que sempre que uma modificação precisar ser feita no sistema, é possível verificar de forma automatizada se algum comportamento foi indevidamente alterado pela modificação realizada.

O sistema Android provê um \textit{framework} para testes\footnote{\url{http://developer.android.com/tools/testing/testing\_android.html}} , com várias ferramentas que ajudam a testar o aplicativo sendo desenvolvido em vários níveis, desde testes unitários a testes relacionados ao \textit{framework} de desenvolvimento e a testes de interface de usuário. Todas as ferramentas necessárias para utilizar a API de testes disponível no \textit{framework} de desenvolvimento Android são disponibilizadas juntamente com o Android SDK.

Podem existir classes em Java puro que não utilizam a API de desenvolvimento do Android. Conseguir fazer essa separação de classes que utilizam o \textit{framework} e classes em Java puro pode significar uma maior facilidade em testar determinadas partes da aplicação, uma vez que podem ser diretamente utilizados os já bem difundidos \textit{JUnit tests} para essas classes. Entretanto, muitas classes são construídas através dos componentes, e o funcionamento das mesmas também precisa ser testado.

As suítes de teste no Android são baseadas em \textit{JUnit}, e então da mesma forma que é possível utilizar \textit{JUnit} para desenvolver testes para classes que não utilizam a API Android, é possível utilizar as extensões do \textit{JUnit} criadas especificamente para testar cada componente do aplicativo sendo desenvolvido. Existem extensões \textit{JUnit} específicas para cada componente Android, e essas classes contém métodos auxiliares para criar \textit{Mock Objects}. Estes são criados para simular outros objetos do contexto de execução real do aplicativo.

O kit de desenvolvimento para a plataforma Android inclui ferramentas automatizadas de teste de interface gráfica. O robotium, por exemplo, realiza testes de caixa preta em cima da interface gráfica do aplicativo. São criadas rotinas de teste em Java semelhantes ao \textit{JUnit}, com \textit{asserts} para validar os resultados. Com ele é possível criar rotinas robustas de testes para validar critérios de aceitação pré-definidos, simulando interações do usuário com uma ou várias \textit{activities}. Existe a ferramenta Monkeyrunner, onde se cria \textit{scripts} em Python para instalar e executar algum aplicativo, enviando comandos e cliques para o mesmo, e salvando \textit{screenshots} do dispositivo no computador com resultados. Há também a ferramenta Monkey, que é utilizada para fazer testes de stress no aplicativo gerando inputs pseudo aleatórios.

\section{Manutenção}

A manutenção de software trata dos esforços de desenvolvimento com o software já em produção, isto é, em funcionamento no seu devido ambiente. Problemas que passaram despercebidos durante as fases de construção e testes são encontrados e corrigidos durante a manutenção do sistema. Da mesma forma, o usuário pode requisitar novas funcionalidades que ele não havia pensado antes do uso do sistema, e o desenvolvimento dessas novas funcionalidades é também tratado como manutenção uma vez que o software já se encontra em produção, num processo conhecido como evolução de software. Revisões de código e esforços com manutenibilidade também podem ser consideradas atividades de manutenção, embora possam acontecer antes do sistema entrar em produção.

A manutenção de software geralmente acontece por período mais longo que as demais fases do desenvolvimento do software citadas nos tópicos anteriores, ocupando a maior parte do ciclo de vida do produto.

A separação de componentes independentes apresentados neste capítulo é de grande valia para a manutenibilidade do sistema. Essa separação permite que componentes tenham sua funcionalidade específica melhor compreendida e possam ser substituídos sem grandes impactos nos demais. 

Atividades de design de software devem ser reforçadas para garantir uma fase de manutenção com a menor quantidade de problemas possível. Uma arquitetura modularizada é mais fácil de ser entendida e modificada e consequentemente mantida. Também é importante que se utilize de padrões de codificação, identação e documentação para que a manutenção seja facilitada inclusive para desenvolvedores que não tem familiaridade com o código desenvolvido. Empresas tendem a colocar equivocadamente engenheiros junior para dar manutenção a sistemas e engenheiros mais experientes para desenvolver novos projetos, e adotar práticas de desenvolvimento que agem em favor à manutenibilidade ajudam a amenizar os problemas causados por esse tipo de alocação de recursos humanos.

Sendo um sistema de código aberto, o Android permite que o desenvolvedor possa o analisar e consequentemente o entender a ponto de corrigir \textit{bugs} do sistema, criar funcionalidades novas, e também portá-lo para novos \textit{hardwares} \cite{googleandroid}. Isso é um ponto importante para atividades de manutenção do sistema Android como um todo, e permitiu que a plataforma crescesse de forma extremamente acelerada em um pequeno espaço de tempo. Um dos motivos para a própria plataforma Linux estar em um estado tão estável nos dias atuais foi os anos que a mesma teve de contribuição da comunidade sendo um software livre e portanto tendo seu código aberto a qualquer desenvolvedor, assim como o sistema Android.