\chapter{Android OS}
\label{cap:android-os}

O Android\footnote{Para mais informações acesse \citeonline{googledev}} é um sistema operacional para dispositivos móveis com base em kernel linux modificado, com várias bibliotecas modificadas ou refeitas, de forma a deixar o sistema tão eficiente quanto possível para hardware limitado que os dispositivos alvo apresentam. A exemplo disso está a biblioteca C Bionic, que foi desenvolvida para menor consumo de espaço físico, memória e poder de processamento que as bibliotecas padrão C como a GNU C (glibc) \cite{devos2014}. 

Aplicações desenvolvidas para Android são feitas essencialmente em linguagem Java, com a possibilidade de utilizar outras linguagens como C e C++ através da Java native interface (JNI). 

O sistema Android tira vantagem do kernel linux no que diz respeito a identificação e separação de processos rodando no sistema, atribuindo a cada aplicação um UID (User Identification), e executando cada uma em um processo diferente, isolando umas das outras.  Independentemente de a aplicação ser desenvolvida em java ou com código nativo, essa separação de processos do kernel, conhecida como Application Sandbox, garante que a está isolada das demais e portanto sujeita aos mesmos mecanismos de segurança inclusive que os aplicativos do sistema, como contatos, câmera, entre outros. 

Cada uma dessas aplicações no sistema funciona em uma instancia diferente da Dalvik Virtual Machine (DVM), uma máquina virtual semelhante a Java Virtual Machine (JVM). Códigos em java são compilados e traduzidos para formato .dex (dalvik executable), que é executado pela DVM, semelhante ao formato .jar do Java. Essa separação permite que uma falha em um processo de uma aplicação não tenha impacto algum em outra aplicação. 

Para interagir com determinados serviços do sistema bem como outras aplicações, uma aplicação deve ter os privilégios correspondentes a ação que deseja executar. Por exemplo, o desenvolvedor pode solicitar ao sistema que sua aplicação tenha acesso a internet, privilégio não concedido por padrão pelo sistema. O usuário então no momento da instalação dessa aplicação é informado que a mesma deseja acesso a internet, e ele deve permitir acesso se quiser concluir a instalação. Todas as permissões requisitadas pelo desenvolvedor e necessárias para o aplicativo realizar suas funções são listadas no momento de instalação, e todas devem ser aceitas, caso contrário a instalação é cancelada. Não é permitido ao usuário selecionar quais permissões ele quer conceder e quais rejeitar à aplicação sendo instalada, tendo apenas as opções de aceitar todas elas, ou rejeitar a instalação. 

Aplicações no android são construídas a partir de quatro tipos de componentes principais: Activities, Services, Broadcast Receivers, e Content Providers \cite{heuser2014}. 

\begin{enumerate}
\item Uma activity é basicamente o código para uma tarefa bem específica a ser realizada pelo usuário. Geralmente apresenta uma interface gráfica(Graphic User Interface) para a realização dessa tarefa. 

\item Services são tarefas que são executadas em background, sem interação com o usuário. Services podem funcionar no processo principal de uma aplicação ou no seu próprio processo. Um bom exemplo de services são os tocadores de músicas. Mesmo que sua interface gráfica não esteja mais visível, é esperado que a música continue a tocar, mesmo se o usuário estiver interagindo com outro aplicativo. 

\item Broadcast Receiver é um componente que é chamado quando um Intent é criado por alguma aplicação ou pelo sistema. Intents são mecanismos para comunicação entre processos, podendo informar algum evento, ou transmitir dados de um para o outro.
Um aplicativo pode receber um Intent criado por outro aplicativo, ou mesmo receber intents do próprio sistema, como por exemplo informação de que a bateria está fraca ou de que uma busca por dispositivos bluetooth previamente requisitada foi concluída. 

\item Content providers são componentes que gerenciam o acesso a um conjunto de dados. São utilizados para criar um ponto de acesso a determinada informação para outras aplicações. Para os contatos do sistema, por exemplo, existe um Content Provider responsável por gerenciar leitura e escrita desses contatos. 
\end{enumerate}


Cada um desses componentes pode funcionar independente dos demais. O sistema android foi desenvolvido dessa forma para que uma tarefa mais complexa seja concluída com a ajuda e interação de vários desses componentes independente da aplicação a qual eles pertencem, não necessitando que um desenvolvedor apenas crie mecanismos para todas as etapas de uma atividade mais longa do usuário.  

Para executar a tarefa de ler um e-mail, por exemplo, um usuário instala um aplicativo de gerenciamento de e-mails. Então ele deseja abrir um anexo de um e-mail que está em formato PDF. O aplicativo de e-mail não precisa necessariamente prover um leitor de PDF para que o usuário consiga ter acesso a esse anexo. Ele pode mandar ao sistema a intenção de abrir um arquivo PDF a partir de um Intent, e então o sistema encontra um outro componente que pode fazer isso, e o instancia. Caso mais de um seja encontrado, o sistema pergunta para o usuário qual é o componente que ele deseja utilizar. O sistema então invoca uma Activity de um outro aplicativo para abrir esse arquivo. Continuando no mesmo exemplo, o usuário clica em um link dentro do arquivo pdf. Esse aplicativo, por sua vez, pode enviar ao sistema a intenção de abrir um endereço web, que mais uma vez encontra um aplicativo capaz de o fazer.  

É importante perceber que para uma atividade mais complexa de interação com o usuário, vários aplicativos são envolvidos sem que os mesmos tenham conhecimento dos demais. Cada componente se "registra" no sistema para realizar determinada tarefa, e o sistema se encarrega de encontrar os componentes adequados para cada situação. Esse registro dos componentes é realizado através do AndroidManifest.xml, que é um arquivo incluso em toda aplicação sendo instalada. Ele reúne todos os componentes de uma aplicação, as permissões necessárias para acessar cada um deles, e as permissões que eles utilizam, bem como outras informações. 

Uma vez que os componentes de uma aplicação podem ser utilizados por outras aplicações, é necessário um controle maior sobre quem pode ter acesso a cada um deles. Cada desenvolvedor pode criar permissões customizadas para seus componentes, e exigir que o aplicativo que requisite a tarefa tenha essa permissão para acessar o componente. Da mesma forma, o aplicativo que criou essa permissão determina os critérios para conceder a mesma para outros aplicativos. Um simples exemplo de uso desse mecanismos é o fato de uma empresa apenas criar vários aplicativos para tarefas distintas e querer integração entre os mesmos. O desenvolvedor pode definir uma permissão específica para acessar um dos seus Content Providers, por exemplo, e definir que apenas aplicativos com a mesma assinatura (assinados pelo mesmo desenvolvedor) possam receber essa permissão. Dessa forma, todos os aplicativos desenvolvidos por essa empresa podem ter acesso aos dados gerenciados por esse Content Provider, enquanto as demais aplicações não tem esse acesso. 

O android foi pensado para executar em uma imensa variedade de dispositivos, de telefones a tablets e televisões. Isso é muito interessante no ponto de vista do desenvolvedor, que tem como mercado para seu software usuários de diversos dispositivos de diversas marcas diferentes. Entretanto, isso trás uma necessidade de fazer uma interface flexível, que permita que um aplicativo seja utilizável em vários tipos de dispositivos, com vários tamanhos de tela. Para facilitar esse problema, o android oferece um framework em que se pode prover recursos gráficos separados específicos para cada configuração de tela, publicando então um aplicativo apenas que se apresenta de forma diferente dependendo do dispositivo onde ele está sendo executado.  

A interface gráfica no android é construída em xml, e tem um padrão de navegação para as aplicações, embora fique a critério do desenvolvedor a aparência de sua aplicação. O desenvolvedor por criar, por exemplo, uma interface gráfica com arquivos xml para cada tamanho de tela, e também diferenciar entre modo paisagem e modo retrato. Entretanto, em se tratando de interface gráfica, vários componentes vão sendo adicionados a API android ao longo de sua evolução, e portanto vários recursos gráficos necessitam de uma versão mínima do sistema para serem utilizados. Utilizar um recurso presente apenas a partir da versão 4.0.4 (Ice Cream Sandwich), por exemplo, implica que o aplicativo não tenha compatibilidade com versões anteriores do sistema.  

Da mesma forma, devido a diversa variedade de modelos e fabricantes de hardware, é preciso ficar atento aos recursos de hardware disponíveis para cada dispositivo. Alguns sensores hoje mais comuns aos novos dispositivos sendo lançados no mercado não existiam em modelos mais antigos. O desenvolvedor pode especificar no android manifest os recursos necessários para o funcionamento completo de sua aplicação, de forma que a mesma seja apenas instalada em dispositivos que os apresentarem. Também pode ser feita uma checagem em tempo de execução e apenas desativar uma funcionalidade do aplicativo caso algum recurso de hardware não esteja disponível no dispositivo, se isso for o desejo do desenvolvedor. De forma geral, é relativamente simples a forma com que o desenvolvedor especifica os dispositivos alvo para sua aplicação, tornando essa grande diversidade de dispositivos mais vantajosa do que dispendiosa. 

Android é um sistema livre, que pode ser utilizado em modificado e utilizado segundo a licença apache versão 2.2. \citeonline{shanker2011} apresenta alguns tópicos relacionados a portabilidade do sistema Android em um novo hardware. Embora não seja discutida nesse documento, a relativamente fácil portabilidade do sistema para vários tipos de hardware foi uma das razões que levaram seu rápido crescimento, fazendo com que várias fabricantes possam fazer uso do mesmo sistema e lançar vários tipos de dispositivos distintos no mercado, com diferentes features e preços, alcançando parcelas do mercado que possuem condições de aquisição muito variadas.





